<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Obfuscador Forte de Lua</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1e1e1e;
            color: #f0f0f0;
            margin: 40px;
        }
        .container {
            max-width: 600px;
            margin: auto;
            background: #2e2e2e;
            padding: 20px;
            border-radius: 8px;
        }
        input, button {
            margin: 10px 0;
            padding: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Obfuscador Forte de Script Lua</h1>
    <input type="file" id="fileInput" accept=".txt,.lua">
    <label>Profundidade:</label>
    <input type="number" id="depthInput" value="3" min="1" max="10">
    <button onclick="obfuscate()">Obfuscar e Baixar</button>
    <p id="status"></p>
</div>

<script>
    function randName() {
        return '_' + Math.random().toString(36).substring(2, 10);
    }

    function xor(str, key) {
        return Array.from(str).map((c, i) => 
            String.fromCharCode(c.charCodeAt(0) ^ key.charCodeAt(i % key.length))
        ).join('');
    }

    function hex(str) {
        return Array.from(str).map(c => 
            c.charCodeAt(0).toString(16).padStart(2, '0')
        ).join('');
    }

    function base64(str) {
        return btoa(unescape(encodeURIComponent(str)));
    }

    function multiEncode(data, key) {
        let xored = xor(data, key);
        let hexed = hex(xored);
        return base64(hexed);
    }

    function generateObfuscatedLoader(encoded, key, checksum) {
        let f1 = randName();
        let f2 = randName();
        let f3 = randName();
        let f4 = randName();
        let varCode = randName();
        let junk = randName();

        return `
local ${f1} = function(s,k)
    local r = ''
    for i = 1, #s do
        r = r .. string.char(tonumber(s:sub(i*2-1,i*2),16) ~ k:byte((i-1)%#k+1))
    end
    return r
end

local ${f2} = function(s)
    return (s:gsub('.', function(c)
        return string.format('%02X', string.byte(c))
    end))
end

local ${f3} = function(s)
    return (s:gsub('..', function(cc)
        return string.char(tonumber(cc,16))
    end))
end

local ${f4} = function(s)
    local b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
    return (s:gsub('.', function(x)
        if x=='=' then return '' end
        local r,f='',(b:find(x)-1)
        for i=6,1,-1 do r=r..(f%2^i-f%2^(i-1)>0 and '1' or '0') end
        return r
    end):gsub('%d%d%d?%d?%d?%d?', function(x)
        if #x ~= 8 then return '' end
        local c = 0
        for i = 1, 8 do
            c = c + (x:sub(i,i) == '1' and 2^(8-i) or 0)
        end
        return string.char(c)
    end))
end

local ${varCode} = '${encoded}'
local ${junk} = '${key}'
local payload = ${f1}(${f4}(${varCode}), ${junk})
assert(load(payload))()
`;
    }

    function recursiveObfuscate(payload, depth) {
        let current = payload;
        for (let i = 0; i < depth; i++) {
            const key = Math.random().toString(36).substring(2, 8);
            const encoded = multiEncode(current, key);
            const checksum = 0; // opcional
            current = generateObfuscatedLoader(encoded, key, checksum);
        }
        return current;
    }

    function obfuscate() {
        const fileInput = document.getElementById('fileInput');
        const depthInput = document.getElementById('depthInput');
        const status = document.getElementById('status');

        if (!fileInput.files.length) {
            alert("Selecione um arquivo .txt ou .lua!");
            return;
        }

        const file = fileInput.files[0];
        const reader = new FileReader();

        reader.onload = function(e) {
            const payload = e.target.result;
            const depth = parseInt(depthInput.value) || 3;

            status.textContent = "Obfuscando...";

            const final = recursiveObfuscate(payload, depth);

            const blob = new Blob([final], { type: 'text/plain' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = file.name.replace(/\.(txt|lua)$/, '') + '_obf.lua';
            a.click();

            status.textContent = "✅ Código obfuscado e baixado!";
        };

        reader.readAsText(file);
    }
</script>

</body>
</html>

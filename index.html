<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Obfuscador Lua Avançado</title>
<style>
body {
    background-color: #1e1e1e;
    color: white;
    font-family: monospace;
    padding: 20px;
}
textarea {
    width: 100%;
    height: 300px;
    background-color: #2e2e2e;
    color: white;
    border: none;
    padding: 10px;
}
button {
    padding: 10px 20px;
    background: #4caf50;
    border: none;
    color: white;
    cursor: pointer;
}
</style>
</head>
<body>

<h1>Obfuscador Lua Avançado 🔥</h1>
<p>Cole seu script Lua abaixo:</p>
<textarea id="input"></textarea>

<p>Resultado obfuscado:</p>
<textarea id="output" readonly></textarea>
<br>
<button onclick="obfuscate()">Obfuscar 🚀</button>

<script>
function randomName() {
    const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
    let name = '_';
    for (let i = 0; i < 15; i++) {
        name += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return name;
}

function encodeString(str) {
    const key = Math.floor(Math.random() * 255);
    const encoded = str.split('').map(c => c.charCodeAt(0) ^ key);
    return {
        encoded,
        key
    };
}

function junkCode() {
    let junk = '';
    const varName = randomName();
    const num1 = Math.floor(Math.random() * 100000);
    const num2 = Math.floor(Math.random() * 100000);
    junk += `local ${varName} = (${num1} * ${num2}) % ${Math.floor(Math.random() * 9999) + 1000}\n`;
    if (Math.random() > 0.5) {
        const dummyFunc = randomName();
        junk += `local function ${dummyFunc}()\n    return ${Math.floor(Math.random() * 999999)}\nend\n`;
    }
    return junk;
}

function obfuscate() {
    const input = document.getElementById('input').value;
    const lines = input.split('\n');

    const varMap = {};
    const outputLines = [];

    outputLines.push('--[[Obfuscado por 🔥 Obfuscador Lua Avançado 🔥]]\n');

    // Adiciona máquina de fluxo
    const stateVar = randomName();
    outputLines.push(`local ${stateVar} = 1\nwhile true do\n`);

    let state = 1;

    lines.forEach(line => {
        const trimmed = line.trim();
        if (trimmed.length === 0) return;

        const lineStateVar = randomName();
        const currentState = state++;

        outputLines.push(`if ${stateVar} == ${currentState} then\n`);

        // Renomeia variáveis simples
        let processedLine = trimmed.replace(/local\s+([a-zA-Z_][a-zA-Z0-9_]*)/g, (match, p1) => {
            const newName = randomName();
            varMap[p1] = newName;
            return `local ${newName}`;
        });

        // Substitui usos de variáveis
        for (let orig in varMap) {
            const regex = new RegExp('\\b' + orig + '\\b', 'g');
            processedLine = processedLine.replace(regex, varMap[orig]);
        }

        // Obfusca strings
        processedLine = processedLine.replace(/"([^"]+)"|'([^']+)'/g, (match, p1, p2) => {
            const str = p1 || p2;
            const { encoded, key } = encodeString(str);
            const bytes = encoded.map(c => tostringLua(c)).join(',');
            const decodeVar = randomName();
            return `((function()\n local ${decodeVar} = {${bytes}}\n local str = ''\n for i=1,#${decodeVar} do str = str .. string.char(${decodeVar}[i] ~ ${key}) end\n return str\n end)())`;
        });

        // Adiciona junk aleatório
        if (Math.random() > 0.5) {
            outputLines.push(junkCode());
        }

        outputLines.push(`${processedLine}\n`);
        outputLines.push(`${stateVar} = ${currentState + 1}\n`);
        outputLines.push('end\n');
    });

    outputLines.push('break\nend');

    document.getElementById('output').value = outputLines.join('');
}

function tostringLua(num) {
    return num >= 0 ? num : `-${Math.abs(num)}`;
}
</script>

</body>
</html>
